{% extends 'base.html' %}

{% block title %}Invoice {{ invoice.invoice_number }} - ERP System{% endblock %}
{% block page_title %}Invoice Details{% endblock %}

{% block content %}
<div class="mb-3">
    <a href="{% url 'invoices:list' %}" class="btn btn-secondary">‚Üê Back to Invoices</a>
    <a href="{% url 'invoices:pdf' invoice.id %}" class="btn btn-info text-white">
        <i class="bi bi-file-earmark-pdf"></i> Download PDF
    </a>
    {% if invoice.status == 'paid' %}
    <button class="btn btn-secondary" disabled title="Invoice is locked">
        <i class="bi bi-lock-fill"></i> Locked
    </button>
    {% else %}
    <a href="{% url 'invoices:update' invoice.id %}" class="btn btn-primary">Edit Invoice</a>
    {% endif %}
</div>

<div class="invoice-detail">
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
        <div>
            <h3>Invoice Information</h3>
            <p><strong>Invoice Number:</strong> {{ invoice.invoice_number }}</p>
            <p><strong>Date:</strong> {{ invoice.date }}</p>
            <p><strong>Due Date:</strong> {{ invoice.due_date }}</p>
            <p><strong>Status:</strong>
                {% if invoice.status == 'paid' %}
                <span class="badge badge-success">Paid</span>
                {% elif invoice.status == 'sent' %}
                <span class="badge badge-info">Sent</span>
                {% elif invoice.status == 'cancelled' %}
                <span class="badge badge-danger">Cancelled</span>
                {% else %}
                <span class="badge badge-warning">Draft</span>
                {% endif %}
            </p>
        </div>
        <div>
            <h3>Customer Information</h3>
            <p><strong>Name:</strong> {{ invoice.customer.name }}</p>
            <p><strong>Email:</strong> {{ invoice.customer.email|default:"-" }}</p>
            <p><strong>Phone:</strong> {{ invoice.customer.phone|default:"-" }}</p>
            <p><strong>Address:</strong> {{ invoice.customer.address|default:"-" }}</p>
        </div>
    </div>

    <h3>Invoice Items</h3>
    <table class="table">
        <thead>
            <tr>
                <th>Product</th>
                <th>Quantity</th>
                <th>Unit Price</th>
                <th>Line Total</th>
            </tr>
        </thead>
        <tbody>
            {% for item in invoice.items.all %}
            <tr>
                <td>{{ item.product.name }}</td>
                <td>{{ item.quantity }}</td>
                <td>Rs {{ item.unit_price }}</td>
                <td>Rs {{ item.line_total }}</td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr>
                <td colspan="3" style="text-align: right;"><strong>Total:</strong></td>
                <td><strong>Rs {{ invoice.total_amount }}</strong></td>
            </tr>
        </tfoot>
    </table>

    {% if invoice.notes %}
    <div class="mt-3">
        <h3>Notes</h3>
        <p>{{ invoice.notes }}</p>
    </div>
    {% endif %}
</div>
{% endblock %}